<!--
 ~ Copyright 2022 youngmonkeys.org
 ~ 
 ~ Licensed under the ezyplatform, Version 1.0.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~ 
 ~     https://youngmonkeys.org/licenses/ezyplatform-1.0.0.txt
 ~ 
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
-->

<!DOCTYPE html>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:ezy="http://www.ezyplatform.com/thymeleaf/layout"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{ezytheme}">
<head>
    <th:block th:if="${checkoutStyleFragment != null}">
        <th:block th:replace="~{${checkoutStyleFragment} :: styles}" />
    </th:block>
</head>
<body>
<th:block layout:fragment="content">
    <div th:if="${checkoutUIFragment == null}" class="container mt-4 shopping-cart-checkout-wrapper">
        <div class="row shopping-cart-checkout">
            <div class="col-12 mb-4">
                <h4 class="shopping-cart-checkout-title">[[#{shopping_cart}]]</h4>
            </div>
            <div class="col-md-8 shopping-cart-checkout-content-left">
                <div th:each="product, iterator : ${shoppingCart.products}" class="row product-small mb-3"
                     th:classappend="${iterator.index == iterator.size - 1 ? 'last-child' : ''}">
                    <div class="col-lg-5 col-md-12 d-flex mb-lg-0 mb-2">
                        <a th:if="${product.product.iconImage != null || product.product.bannerImage != null}"
                           th:attr="onclick=|onShoppingCartProductClick(${product.product.id}, '${product.product.productCode}')|"
                           href="javascript:void(0)" class="me-3">
                            <img th:if="${product.product.iconImage != null}"
                                 th:src="${product.product.iconImage.getUrlOrDefault('')}"
                                 class="object-fit-cover" width="64" height="64">
                            <img th:if="${product.product.iconImage == null && product.product.bannerImage != null}"
                                 th:src="${product.product.bannerImage.getUrlOrDefault('')}"
                                 class="object-fit-cover" width="64" height="64">
                        </a>
                        <div class="d-flex flex-column justify-content-center">
                            <span class="shopping-cart-product-name">[[${product.product.productName}]]</span>
                            <span th:if="${product.color != null}" class="shopping-cart-product-color">
                                [[#{color_short_title}]]: [[${product.color.colorDisplayName}]]
                            </span>
                            <span th:if="${product.material != null}" class="shopping-cart-product-material">
                                [[#{material}]]: [[${product.material.materialDisplayName}]]
                            </span>
                            <span th:if="${product.size != null}" class="shopping-cart-product-size">
                            [[#{size}]]:
                            <th:block th:if="${product.size.sizeName != 'Customize'}">
                                [[${product.size.sizeDisplayName}]]
                            </th:block>
                            <th:block th:if="${product.size.sizeName == 'customize'}">
                                [[#{customize}]]
                            </th:block>
                        </span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-12 d-md-flex d-none flex-column justify-content-center">
                        <span>[[${defaultCurrency.formatPriceIncludeSymbol(product.product.price)}]]</span>
                    </div>
                    <div class="col-lg-2 col-md-4 col-12 d-md-none d-flex flex-row gap-2">
                        <label>[[#{price}]]:</label>
                        <span>[[${defaultCurrency.formatPriceIncludeSymbol(product.product.price)}]]</span>
                    </div>
                    <div class="col-lg-2 col-md-3 col-12 d-md-flex d-none flex-column justify-content-center">
                        <div class="d-flex align-items-center checkout-product-amount-wrapper">
                            <button th:if="${allowChangeCheckoutProductCount == true}"
                                    type="button" class="btn checkout-minus-product-button"
                                    th:classappend="${'checkout-minus-product-button-' + product.id}"
                                    th:attr="onclick=|onCheckoutMinusProductButtonClick(this, ${product.id})|">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="commas-number-string"
                                  th:classappend="${'checkout-product-amount-' + product.id}">
                            [[${product.amount}]]
                        </span>
                            <button th:if="${allowChangeCheckoutProductCount == true}"
                                    type="button" class="btn checkout-plus-product-button"
                                    th:classappend="${'checkout-plus-product-button-' + product.id}"
                                    th:attr="onclick=|onCheckoutPlusProductButtonClick(this, ${product.id})|">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3 col-12 d-md-none d-flex flex-row gap-2 align-items-center">
                        <label>[[#{quantity}]]:</label>
                        <div class="d-flex align-items-center checkout-product-amount-wrapper">
                            <button th:if="${allowChangeCheckoutProductCount == true}"
                                    type="button" class="btn checkout-minus-product-button"
                                    th:classappend="${'checkout-minus-product-button-' + product.id}"
                                    th:attr="onclick=|onCheckoutMinusProductButtonClick(this, ${product.id})|">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="commas-number-string"
                                  th:classappend="${'checkout-product-amount-' + product.id}">
                            [[${product.amount}]]
                        </span>
                            <button th:if="${allowChangeCheckoutProductCount == true}"
                                    type="button" class="btn checkout-plus-product-button"
                                    th:classappend="${'checkout-plus-product-button-' + product.id}"
                                    th:attr="onclick=|onCheckoutPlusProductButtonClick(this, ${product.id})|">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-10 d-md-flex d-none flex-column justify-content-center">
                    <span th:class="${'checkout-product-total-amount-money-' + product.id}">
                        [[${defaultCurrency.formatPriceIncludeSymbol(product.totalAmountMoney)}]]
                    </span>
                    </div>
                    <div class="col-lg-2 col-md-4 col-10 d-md-none d-flex flex-row gap-2">
                        <label>[[#{total_amount}]]:</label>
                        <span th:class="${'checkout-product-total-amount-money-' + product.id}">
                        [[${defaultCurrency.formatPriceIncludeSymbol(product.totalAmountMoney)}]]
                    </span>
                    </div>
                    <div class="col-md-1 col-2 d-flex flex-column justify-content-center">
                        <button type="button" class="btn btn-link text-danger d-flex justify-content-center delete-shopping-cart-product-button"
                                th:attr="onclick=|deleteShoppingCartProduct(${product.id})|">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div th:if="${shoppingCart.containsDeliveryRequiredProduct == true}"
                     class="row checkout-order-delivery-information"
                     id="checkOutOrderDeliveryInformationArea">
                    <div class="col-12">
                        <hr class="mt-3 checkout-order-delivery-information-separator">
                    </div>
                    <div class="col-12">
                        <h2 class="section-title">[[#{delivery_information}]]</h2>
                        <p class="section-content-text d-none">
                            [[#{do_you_have_an_account}]]
                            <a class="cursor-pointer text-decoration-none" onclick="onLoginWhenCheckoutClick();"
                               id="loginWhenCheckoutButton">
                                [[#{login}]]
                            </a>
                        </p>
                    </div>
                    <div class="col-12">
                        <form id="orderRecipientInformationForm" onsubmit="return false;">
                            <input type="text" name="deliveryFullName" id="recipientFullName"
                                   class="form-control" th:placeholder="#{full_name}"
                                   th:value="${user != null && user.displayName != null && !user.displayName.startsWith('Anonymous') ? user.displayName : ''}"
                                   required
                                   oninput="onDeliveryRecipientInformationChange(this);">
                            <div class="form-group row mt-2">
                                <div class="col-md-8 pe-auto pe-md-0">
                                    <input type="email" name="deliveryEmail" id="recipientEmail"
                                           class="form-control" th:placeholder="#{email} + ${requireCheckoutEmail ? '' : ' ('} + #{${requireCheckoutEmail ? 'empty_string' : 'optional'}} + ${requireCheckoutEmail ? '' : ')'}"
                                           th:value="${user != null ? user.email : ''}"
                                           th:required="${requireCheckoutEmail}"
                                           oninput="onDeliveryRecipientInformationChange(this);">
                                </div>
                                <div class="col-md-4 mt-md-auto mt-2">
                                    <input type="tel" name="deliveryPhoneNumber" id="recipientPhoneNumber"
                                           class="form-control" th:placeholder="#{phone_number}"
                                           th:value="${user != null ? user.phone : ''}"
                                           required
                                           oninput="onDeliveryRecipientInformationChange(this);">
                                </div>
                            </div>
                            <input type="text" name="deliveryNotes" id="recipientNotes"
                                   class="form-control mt-2"
                                   th:placeholder="#{note} + ' (' + #{optional} + ')'"
                                   oninput="onDeliveryRecipientInformationChange(this);">
                            <div class="card mt-3">
                                <div class="card-header">
                                    <div class="d-flex gap-2 align-items-center cursor-pointer"
                                         onclick="onDeliveryOptionHomeClick();">
                                        <input type="radio" name="deliveryOption" id="deliveryOptionHome"
                                               value="HOME_DELIVERY" checked>
                                        <span>[[#{home_delivery}]]</span>
                                    </div>
                                </div>
                                <div class="card-body" id="deliveryOptionHomeBody">
                                    <div class="form-group row">
                                        <div th:class="${showDeliveryCountrySelection && deliveryCountries.size() > 1 ? 'col-md-8 pe-auto pe-md-0' : 'col-md-12'}">
                                            <input name="deliveryAddress" class="form-control" th:placeholder="#{detailed_address}"
                                                   id="recipientAddress"
                                                   th:value="${deliveryRecentlyAddress}"
                                                   required
                                                   oninput="onDeliveryRecipientInformationChange(this);">
                                        </div>
                                        <div class="col-md-4 mt-md-auto mt-2"
                                             th:if="${showDeliveryCountrySelection && deliveryCountries.size() > 1}">
                                            <select name="deliveryCountryId" class="form-select" id="recipientCountry"
                                                    onchange="onCountryChange(this);" required>
                                                <option value="" th:selected="${deliveryFirstCountry == null}">[[#{select_a_country}]]</option>
                                                <option th:each="deliveryCountry: ${deliveryCountries}"
                                                        th:value="${deliveryCountry.id}"
                                                        th:selected="${deliveryCountry.id == deliveryRecentlyCountryId}">
                                                    [[${deliveryCountry.internationalName}]]
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row mt-2">
                                        <div class="col-md-4 mt-md-auto mt-2 pe-auto pe-md-0">
                                            <select name="deliveryProvinceId" class="form-select" id="recipientProvince"
                                                    onchange="onProvinceChange(this);" required>
                                                <option value="" selected>[[#{select_a_province}]]</option>
                                                <option th:each="deliveryProvince : ${deliveryProvinces}"
                                                        th:value="${deliveryProvince.id}"
                                                        th:selected="${deliveryProvince.id == deliveryRecentlyProvinceId}">
                                                    [[${deliveryProvince.displayName}]]
                                                </option>
                                                <option value="0">[[#{not_found_option}]]</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mt-md-auto mt-2 pe-auto pe-md-0">
                                            <select name="deliveryDistrictId" class="form-select" id="recipientDistrict"
                                                    onchange="onDistrictChange(this);" required>
                                                <option value="" selected>[[#{select_a_district}]]</option>
                                                <option th:each="deliveryDistrict : ${deliveryDistricts}"
                                                        th:value="${deliveryDistrict.id}"
                                                        th:selected="${deliveryDistrict.id == deliveryRecentlyDistrictId}">
                                                    [[${deliveryDistrict.displayName}]]
                                                </option>
                                                <option value="0">[[#{not_found_option}]]</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mt-md-auto mt-2">
                                            <select name="deliveryWardId" class="form-select" id="recipientWard" required>
                                                <option value="" selected>[[#{select_a_ward}]]</option>
                                                <option th:each="deliveryWard : ${deliveryWards}"
                                                        th:value="${deliveryWard.id}"
                                                        th:selected="${deliveryWard.id == deliveryRecentlyWardId}">
                                                    [[${deliveryWard.displayName}]]
                                                </option>
                                                <option value="0">[[#{not_found_option}]]</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card"
                                 th:if="${allowUserReceivedStockBranchIds != null && allowUserReceivedStockBranchIds.size() > 0}">
                                <div class="card-header">
                                    <div class="d-flex gap-2 align-items-center cursor-pointer" onclick="onDeliveryOptionStoreClick();">
                                        <input type="radio" name="deliveryOption" id="deliveryOptionStore"
                                               value="PICK_UP_AT_STORE">
                                        <span>[[#{pick_up_at_store}]]</span>
                                    </div>
                                </div>
                                <div class="card-body d-flex flex-column gap-3 d-none" id="deliveryOptionStoreBody">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-3">
                        <div class="d-flex align-items-center change-delivery-information-button-wrapper">
                            <button type="button" class="btn btn-link text-decoration-none mt-4 mb-4 d-none"
                                    id="changeDeliveryInformationButton"
                                    onclick="onChangeDeliveryInformationButtonClick()">
                                [[#{change}]]
                            </button>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="d-flex justify-content-end process-to-payment-method-button-wrapper">
                            <button type="button" class="btn btn-primary form-control mt-4 mb-4"
                                    id="processToPaymentMethodButton"
                                    onclick="onProcessToPaymentMethodButtonClick()">
                                [[#{proceed_to_payment_method}]]
                            </button>
                        </div>
                    </div>
                </div>
                <div th:if="${shoppingCart.totalAmountMoney > 0}" class="row d-none"
                     id="bankAccountsArea">
                    <div class="col-12">
                        <hr class="mt-3 bank-accounts-area-separator">
                    </div>
                    <div th:if="${bankAccounts.size() > 0}" class="col-12 mb-3">
                        <h4>[[#{transfer_information}]]</h4>
                    </div>
                    <th:block th:each="bankAccount: ${bankAccounts}">
                        <div class="col-md-6 d-flex flex-column mb-3 checkout-bank-account-information">
                            <h5>[[${bankAccount.bankName}]] ([[${bankAccount.bankCode}]])</h5>
                            <span>[[#{account_number}]]: [[${bankAccount.accountNumber}]]</span>
                            <span>[[#{account_owner}]]: [[${bankAccount.accountOwnerName}]]</span>
                            <span th:if="${bankAccount.bankBranchOfAccount != null && bankAccount.bankBranchOfAccount.trim().length() > 0}">
                            [[#{bank_branch}]]: [[${bankAccount.bankBranchOfAccount}]]
                        </span>
                            <span><span class="text-danger">*</span> [[#{please_do_not_change_the_transfer_details}]]</span>
                        </div>
                        <div class="col-md-6">
                            <div class="pb-md-5 pb-3 d-flex flex-column align-items-center checkout-bank-account-qr-code-container"
                                 th:id="${'bankAccountQrCode' + bankAccount.id}">
                            </div>
                        </div>
                    </th:block>
                </div>
            </div>
            <div class="col-md-4 d-lg-flex flex-column shopping-cart-checkout-content-right">
                <form id="discountCodeForm" onsubmit="return false;">
                    <div class="input-group has-validation d-flex flex-column">
                        <div class="invalid-feedback" id="validateDiscountCodeFeedback">
                            [[#{required}]]
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <input type="text" class="form-control"
                                   id="discountCodeInput"
                                   th:placeholder="#{discount_code}"
                                   th:value="${discountCode}"
                                   onkeydown="onKeydownToSubmitDiscountCount();"
                                   aria-describedby="validateDiscountCodeFeedback" required>
                            <button type="button" class="btn btn-outline-info text-nowrap"
                                    id="discountCodeButton" onclick="submitDiscountCount();">
                                [[#{use}]]
                            </button>
                            <button type="button" class="btn btn-outline-danger text-nowrap d-none"
                                    id="cancelDiscountCodeButton" onclick="onCancelDiscountCodeButton();">
                                [[#{cancel}]]
                            </button>
                        </div>
                    </div>
                </form>
                <hr class="mt-3 discount-form-separator">
                <div class="d-flex flex-column gap-2 shopping-cart-checkout-summary">
                    <div th:if="${shoppingCart.containsDeliveryRequiredProduct == true}"
                         class="d-flex justify-content-between align-item-center">
                        <span id="deliverySubtotalTitle">[[#{subtotal}]]</span>
                        <span id="deliverySubtotalValue">
                        [[${defaultCurrency.formatPriceIncludeSymbol(shoppingCart.totalAmountMoney)}]]
                    </span>
                    </div>
                    <div th:if="${shoppingCart.containsDeliveryRequiredProduct == true}"
                         class="d-flex justify-content-between align-item-center">
                        <span id="deliveryFeeTitle">[[#{delivery_fee}]]</span>
                        <span id="deliveryFeeValue">-</span>
                    </div>
                    <div class="d-flex justify-content-between align-item-center d-none"
                         id="discountValueArea">
                        <span id="discountTitle">[[#{discount}]]</span>
                        <span id="discountValue">-</span>
                    </div>
                    <div class="d-flex justify-content-between align-item-center">
                        <span id="totalMoneyTitle">[[#{total_amount}]]</span>
                        <span id="totalMoneyValue">
                        [[${defaultCurrency.formatPriceIncludeSymbol(shoppingCart.totalAmountMoney)}]]
                    </span>
                    </div>
                </div>
                <th:block th:if="${shoppingCart.products.size() > 0}">
                    <div th:classappend="${shoppingCart.containsDeliveryRequiredProduct == true ? 'd-none' : ''}"
                         id="paymentButtons">
                        <th:block th:if="${shoppingCart.totalAmountMoney > 0}">
                            <button th:each="paymentService, iterator : ${paymentServices}" type="button"
                                    th:class="${'btn btn-' + (iterator.index % 2 == 0 ? 'danger' : 'primary') + ' form-control mt-3 pay-shopping-cart-button'}"
                                    th:classappend="${'pay-via-' + paymentService.name.toLowerCase() + '-button'}"
                                    th:attr="onclick=|redirectToPaymentUrl('${paymentService.code}')|">
                                [[#{pay_via}]] [[${paymentService.name}]]
                            </button>
                            <button th:if="${shoppingCart.containsDeliveryRequiredProduct == true}"
                                    type="button" class="btn btn-secondary form-control mt-3 pay-on-delivery-button pay-shopping-cart-button"
                                    data-bs-toggle="modal" data-bs-target="#confirm-pay-on-delivery">
                                [[#{pay_on_delivery}]]
                            </button>
                            <button th:if="${bankAccounts.size() > 0}"
                                    type="button" class="btn btn-dark form-control mt-3 pay-via-bank-transfer-button pay-shopping-cart-button"
                                    onclick="onPayViaBankTransferButtonClick();">
                                [[#{pay_via}]] [[#{bank_transfer}]]
                            </button>
                            <button type="button" class="btn btn-success form-control mt-3 view-order-button d-none"
                                    data-bs-toggle="modal" data-bs-target="#confirm-bank-transfer"
                                    id="viewOrderButton">
                                [[#{view_order}]]
                            </button>
                        </th:block>
                        <button th:classappend="${shoppingCart.totalAmountMoney == 0 ? '' : 'd-none'}"
                                onclick="createOrder(true)" id="placeOrderButton"
                                type="button" class="btn btn-secondary form-control mt-3 place-order-button">
                            [[#{place_order}]]
                        </button>
                    </div>
                </th:block>
            </div>
        </div>
    </div>
    <th:block th:if="${checkoutUIFragment != null}">
        <th:block th:replace="~{${checkoutUIFragment} :: content}" />
    </th:block>
</th:block>
<th:block layout:fragment="modals">
    <th:block th:if="${bankAccounts.size() > 0}"
              th:replace="~{ezycommon/prompt :: content(id='confirm-bank-transfer', title=#{confirm}, body=${#messages.msg('have_you_completed_the_bank_transfer')}, confirmButton=#{confirm}, closeButton=#{close})}" />
    <th:block th:if="${bankAccounts.size() > 0}"
              th:replace="~{ezycommon/prompt :: content(id='confirm-pay-on-delivery', title=#{confirm}, body=${#messages.msg('are_you_sure_you_want_to_pay_on_delivery')}, confirmButton=#{confirm}, closeButton=#{close})}" />
</th:block>

<th:block layout:fragment="import-scripts">
<script ezy:vsrc="/ecommerce/js/qrcode.min.js"></script>
</th:block>

<th:block layout:fragment="scripts">
    <script th:replace="~{ecommerce/shopping-cart/scripts :: checkout}" />
</th:block>

<th:block layout:fragment="post-scripts">
    <script th:replace="~{ecommerce/checkout/scripts :: common}" />
    <script th:replace="~{ecommerce/country/scripts :: change}" />
</th:block>

<th:block layout:fragment="final-scripts">
    <th:block th:if="${checkoutScriptFragment != null}">
        <th:block th:replace="~{${checkoutScriptFragment} :: scripts}" />
    </th:block>
</th:block>
</body>
</html>
